{% extends 'base.html' %}

{% block title %}Gestion des Participants - Soir√©e Clash{% endblock %}

{% block content %}
<div class="hero-section">
  <h1 class="page-title">üë• Gestion des Participants</h1>
  <p class="page-subtitle">G√©rez les participants de votre √©tablissement</p>
</div>

<!-- Formulaire d'ajout de participant -->
<div class="section">
  <h2 class="section-title">Ajouter un Participant</h2>
  <div class="form-container">
    <form method="post" class="participant-form">
      {% csrf_token %}
      <div class="form-grid">
        <div class="form-group">
          <label for="{{ form.pseudo.id_for_label }}">Pseudo</label>
          {{ form.pseudo }}
          <small class="form-help">Le pseudo doit √™tre unique sur toute la plateforme</small>
        </div>
        
        <div class="form-group">
          <label for="{{ form.nom.id_for_label }}">Nom</label>
          {{ form.nom }}
          <small class="form-help">Nom de famille du participant</small>
        </div>
        
        <div class="form-group">
          <label for="{{ form.prenom.id_for_label }}">Pr√©nom</label>
          {{ form.prenom }}
          <small class="form-help">Pr√©nom du participant</small>
        </div>
        
        <div class="form-group">
          <label for="{{ form.service.id_for_label }}">√âtablissement</label>
          {{ form.service }}
          <small class="form-help">√âtablissement o√π le participant va concourir</small>
        </div>
      </div>
      
      <div class="form-actions">
        <button type="submit" class="btn btn-primary">Ajouter le Participant</button>
      </div>
    </form>
  </div>
</div>

<!-- Liste des participants -->
<div class="section">
  <h2 class="section-title">Participants de votre √âtablissement</h2>
  
  {% if participants %}
    <div class="participants-grid">
      {% for participant in participants %}
        <div class="participant-card">
          <div class="participant-header">
            <div class="participant-avatar">
              {% if participant.user.profile.avatar %}
                <img src="{{ participant.user.profile.avatar.url }}" alt="Avatar de {{ participant.pseudo }}">
              {% else %}
                <div class="avatar-placeholder">{{ participant.pseudo|first|upper }}</div>
              {% endif %}
            </div>
            <div class="participant-info">
              <div class="participant-pseudo">{{ participant.pseudo }}</div>
              <div class="participant-name">{{ participant.nom }} {{ participant.prenom }}</div>
              <div class="participant-etablissement">{{ participant.service.nom }}</div>
            </div>
            <div class="participant-status">
              {% if participant.actif %}
                <span class="status-badge active">‚úÖ Actif</span>
              {% else %}
                <span class="status-badge inactive">‚ùå Inactif</span>
              {% endif %}
            </div>
          </div>
          
          <div class="participant-details">
            <div class="detail-item">
              <span class="detail-label">Date d'inscription :</span>
              <span class="detail-value">{{ participant.date_inscription|date:"d/m/Y" }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Total d√©penses :</span>
              <span class="detail-value">{{ participant.total_depenses_jour|floatformat:0 }} FCFA</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Type √©tablissement :</span>
              <span class="detail-value">{{ participant.service.get_type_display }}</span>
            </div>
          </div>
          
          <div class="participant-actions">
            <button class="btn btn-secondary btn-sm" onclick="voirConsommations('{{ participant.id }}')">
              üìä Voir consommations
            </button>
            <button class="btn btn-warning btn-sm" onclick="modifierParticipant('{{ participant.id }}')">
              ‚úèÔ∏è Modifier
            </button>
            {% if participant.actif %}
              <button class="btn btn-danger btn-sm" onclick="desactiverParticipant('{{ participant.id }}')">
                ‚ùå D√©sactiver
              </button>
            {% else %}
              <button class="btn btn-success btn-sm" onclick="activerParticipant('{{ participant.id }}')">
                ‚úÖ Activer
              </button>
            {% endif %}
          </div>
        </div>
      {% endfor %}
    </div>
    
    <!-- Statistiques des participants -->
    <div class="stats-section">
      <h3 class="stats-title">Statistiques des Participants</h3>
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-icon">üë•</div>
          <div class="stat-content">
            <div class="stat-number">{{ participants.count }}</div>
            <div class="stat-label">Total participants</div>
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon">‚úÖ</div>
          <div class="stat-content">
            <div class="stat-number">
              {% for p in participants %}
                {% if p.actif %}
                  {% with count=forloop.counter0|add:1 %}{% endwith %}
                {% endif %}
              {% endfor %}
              {{ participants|length }}
            </div>
            <div class="stat-label">Participants actifs</div>
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon">üí∞</div>
          <div class="stat-content">
            <div class="stat-number">
              {% with total=0 %}
                {% for p in participants %}
                  {% with total=total|add:p.total_depenses_jour %}{% endwith %}
                {% endfor %}
                {{ total|floatformat:0 }}
              {% endwith %} FCFA
            </div>
            <div class="stat-label">Total d√©penses aujourd'hui</div>
          </div>
        </div>
      </div>
    </div>
  {% else %}
    <div class="empty-state">
      <div class="empty-icon">üë•</div>
      <h3>Aucun participant enregistr√©</h3>
      <p>Commencez par ajouter vos premiers participants pour qu'ils puissent concourir.</p>
    </div>
  {% endif %}
</div>

<!-- Instructions importantes -->
<div class="section info-section">
  <h2 class="section-title">Instructions Importantes</h2>
  <div class="info-grid">
    <div class="info-card">
      <div class="info-icon">üë§</div>
      <h3>Pseudo unique</h3>
      <p>Chaque participant doit avoir un pseudo unique sur toute la plateforme.</p>
    </div>
    <div class="info-card">
      <div class="info-icon">üè™</div>
      <h3>√âtablissement</h3>
      <p>Les participants ne peuvent concourir que dans des √©tablissements avec types de boissons enregistr√©s.</p>
    </div>
    <div class="info-card">
      <div class="info-icon">üìä</div>
      <h3>Classements</h3>
      <p>Les classements se basent sur le montant total d√©pens√© par chaque participant.</p>
    </div>
    <div class="info-card">
      <div class="info-icon">‚è∞</div>
      <h3>D√©lai de saisie</h3>
      <p>Les consommations doivent √™tre saisies avant 12h00 pour le classement du jour.</p>
    </div>
  </div>
</div>

<style>
.hero-section {
  text-align: center;
  padding: 3rem 0;
  background: linear-gradient(135deg, rgba(255,0,77,0.1) 0%, rgba(255,215,0,0.1) 100%);
  border-radius: 1rem;
  margin-bottom: 2rem;
}

.page-title {
  font-size: 3rem;
  font-weight: 800;
  background: linear-gradient(to right, #FF004D, #FFD700);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  margin-bottom: 1rem;
}

.page-subtitle {
  font-size: 1.2rem;
  color: #FFD700;
}

.section {
  margin-bottom: 3rem;
}

.section-title {
  color: #FFD700;
  font-size: 2rem;
  text-align: center;
  margin-bottom: 2rem;
  border-bottom: 2px solid #7B2CBF;
  padding-bottom: 1rem;
}

.form-container {
  max-width: 800px;
  margin: 0 auto;
}

.participant-form {
  background: rgba(26, 18, 58, 0.8);
  padding: 2rem;
  border-radius: 1rem;
  border: 2px solid #7B2CBF;
}

.form-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1.5rem;
  margin-bottom: 2rem;
}

.form-group {
  margin-bottom: 1.5rem;
}

.form-group label {
  display: block;
  margin-bottom: 0.5rem;
  color: #FFD700;
  font-weight: 600;
}

.form-control {
  width: 100%;
  padding: 0.8rem;
  border: 1px solid #7B2CBF;
  border-radius: 0.5rem;
  background: rgba(255,255,255,0.1);
  color: #fff;
  font-size: 1rem;
  box-sizing: border-box;
}

.form-control:focus {
  outline: none;
  border-color: #FFD700;
  box-shadow: 0 0 10px rgba(255,215,0,0.3);
}

.form-help {
  display: block;
  margin-top: 0.5rem;
  color: #7B2CBF;
  font-size: 0.9rem;
}

.form-actions {
  text-align: center;
}

.participants-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
  gap: 2rem;
  margin-bottom: 2rem;
}

.participant-card {
  background: rgba(26, 18, 58, 0.9);
  border-radius: 1rem;
  padding: 1.5rem;
  border: 2px solid #7B2CBF;
  transition: all 0.3s ease;
}

.participant-card:hover {
  transform: translateY(-3px);
  box-shadow: 0 8px 20px rgba(123, 44, 191, 0.3);
}

.participant-header {
  display: flex;
  align-items: center;
  margin-bottom: 1.5rem;
  padding-bottom: 1rem;
  border-bottom: 1px solid rgba(123, 44, 191, 0.3);
}

.participant-avatar {
  margin-right: 1rem;
}

.participant-avatar img {
  width: 50px;
  height: 50px;
  border-radius: 50%;
  object-fit: cover;
}

.avatar-placeholder {
  width: 50px;
  height: 50px;
  border-radius: 50%;
  background: linear-gradient(45deg, #FF004D, #FFD700);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.5rem;
  font-weight: 600;
  color: #fff;
}

.participant-info {
  flex: 1;
}

.participant-pseudo {
  font-size: 1.3rem;
  font-weight: 600;
  color: #FFD700;
  margin-bottom: 0.5rem;
}

.participant-name {
  color: #fff;
  margin-bottom: 0.5rem;
}

.participant-etablissement {
  color: #00C2FF;
  font-size: 0.9rem;
}

.participant-status {
  margin-left: 1rem;
}

.status-badge {
  padding: 0.5rem 1rem;
  border-radius: 2rem;
  font-size: 0.9rem;
  font-weight: 600;
}

.status-badge.active {
  background: rgba(0, 255, 0, 0.2);
  color: #00FF00;
}

.status-badge.inactive {
  background: rgba(255, 0, 0, 0.2);
  color: #FF0000;
}

.participant-details {
  margin-bottom: 1.5rem;
}

.detail-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 0.5rem;
}

.detail-label {
  color: #7B2CBF;
  font-size: 0.9rem;
}

.detail-value {
  color: #fff;
  font-weight: 500;
}

.participant-actions {
  display: flex;
  gap: 0.5rem;
  flex-wrap: wrap;
}

.btn-sm {
  padding: 0.5rem 1rem;
  font-size: 0.9rem;
}

.stats-section {
  background: rgba(26, 18, 58, 0.5);
  padding: 2rem;
  border-radius: 1rem;
  border: 2px solid #7B2CBF;
}

.stats-title {
  color: #FFD700;
  text-align: center;
  margin-bottom: 2rem;
  font-size: 1.5rem;
}

.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 2rem;
}

.stat-card {
  display: flex;
  align-items: center;
  padding: 1.5rem;
  background: rgba(26, 18, 58, 0.8);
  border-radius: 1rem;
  border: 2px solid #7B2CBF;
}

.stat-icon {
  font-size: 2.5rem;
  margin-right: 1rem;
}

.stat-content {
  flex: 1;
}

.stat-number {
  color: #FFD700;
  font-size: 1.8rem;
  font-weight: 600;
  margin-bottom: 0.5rem;
}

.stat-label {
  color: #7B2CBF;
  font-size: 0.9rem;
}

.empty-state {
  text-align: center;
  padding: 3rem;
  color: #7B2CBF;
}

.empty-icon {
  font-size: 4rem;
  margin-bottom: 1rem;
}

.info-section {
  background: rgba(26, 18, 58, 0.3);
  padding: 2rem;
  border-radius: 1rem;
}

.info-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 2rem;
}

.info-card {
  text-align: center;
  padding: 1.5rem;
}

.info-icon {
  font-size: 3rem;
  margin-bottom: 1rem;
}

.info-card h3 {
  color: #FFD700;
  margin-bottom: 1rem;
}

@media (max-width: 768px) {
  .page-title {
    font-size: 2rem;
  }
  
  .form-grid {
    grid-template-columns: 1fr;
  }
  
  .participants-grid {
    grid-template-columns: 1fr;
  }
  
  .stats-grid {
    grid-template-columns: 1fr;
  }
  
  .info-grid {
    grid-template-columns: 1fr;
  }
  
  .participant-header {
    flex-direction: column;
    text-align: center;
  }
  
  .participant-avatar {
    margin-right: 0;
    margin-bottom: 1rem;
  }
  
  .participant-status {
    margin-left: 0;
    margin-top: 1rem;
  }
  
  .participant-actions {
    justify-content: center;
  }
}
</style>

<script>
// Fonctions pour g√©rer les participants
function voirConsommations(participantId) {
  // Rediriger vers la page des consommations avec filtre sur le participant
  window.location.href = `{% url 'app:gestion_consommations' %}?participant=${participantId}`;
}

function modifierParticipant(participantId) {
  // Ouvrir un modal ou rediriger vers une page de modification
  alert('Fonctionnalit√© de modification √† impl√©menter');
}

function desactiverParticipant(participantId) {
  if (confirm('√ätes-vous s√ªr de vouloir d√©sactiver ce participant ?')) {
    // Envoyer une requ√™te pour d√©sactiver le participant
    alert('Fonctionnalit√© de d√©sactivation √† impl√©menter');
  }
}

function activerParticipant(participantId) {
  if (confirm('√ätes-vous s√ªr de vouloir r√©activer ce participant ?')) {
    // Envoyer une requ√™te pour r√©activer le participant
    alert('Fonctionnalit√© de r√©activation √† impl√©menter');
  }
}
</script>
{% endblock %}
